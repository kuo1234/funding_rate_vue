{"ast":null,"code":"import { createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, vModelText as _vModelText, withKeys as _withKeys, withDirectives as _withDirectives, toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock, createTextVNode as _createTextVNode, renderList as _renderList, Fragment as _Fragment, normalizeClass as _normalizeClass } from \"vue\";\nconst _hoisted_1 = {\n  class: \"container\"\n};\nconst _hoisted_2 = {\n  class: \"settings-panel\"\n};\nconst _hoisted_3 = {\n  class: \"setting-item\"\n};\nconst _hoisted_4 = {\n  class: \"threshold-info\"\n};\nconst _hoisted_5 = {\n  key: 0\n};\nconst _hoisted_6 = {\n  key: 0\n};\nconst _hoisted_7 = {\n  key: 0\n};\nconst _hoisted_8 = {\n  key: 0\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_cache[10] || (_cache[10] = _createElementVNode(\"h2\", null, \"Funding Rate Board\", -1 /* CACHED */)), _createCommentVNode(\" 設定區域 \"), _createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_cache[5] || (_cache[5] = _createElementVNode(\"label\", {\n    for: \"threshold\"\n  }, \"過濾閾值 (%):\", -1 /* CACHED */)), _withDirectives(_createElementVNode(\"input\", {\n    type: \"number\",\n    id: \"threshold\",\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.tempThreshold = $event),\n    step: \"0.001\",\n    min: \"0.001\",\n    max: \"10\",\n    class: \"threshold-input\",\n    onKeyup: _withKeys($setup.confirmThreshold, [\"enter\"])\n  }, null, 544 /* NEED_HYDRATION, NEED_PATCH */), [[_vModelText, $setup.tempThreshold]]), _createElementVNode(\"button\", {\n    onClick: $setup.confirmThreshold,\n    class: \"confirm-btn\"\n  }, \"確認\"), _createElementVNode(\"button\", {\n    onClick: $setup.refreshData,\n    class: \"refresh-btn\"\n  }, \"重新整理\"), _createElementVNode(\"span\", _hoisted_4, \"目前顯示閾值: \" + _toDisplayString($setup.filterThreshold) + \"%\", 1 /* TEXT */)])]), _createElementVNode(\"table\", null, [_createElementVNode(\"thead\", null, [_createElementVNode(\"tr\", null, [_createElementVNode(\"th\", {\n    onClick: _cache[1] || (_cache[1] = $event => $setup.setSort('symbol')),\n    style: {\n      \"cursor\": \"pointer\"\n    }\n  }, [_cache[6] || (_cache[6] = _createTextVNode(\" Symbol \", -1 /* CACHED */)), $setup.sortKey === 'symbol' ? (_openBlock(), _createElementBlock(\"span\", _hoisted_5, _toDisplayString($setup.sortDesc ? '↓' : '↑'), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true)]), _createElementVNode(\"th\", {\n    onClick: _cache[2] || (_cache[2] = $event => $setup.setSort('btcc')),\n    style: {\n      \"cursor\": \"pointer\"\n    }\n  }, [_cache[7] || (_cache[7] = _createTextVNode(\" BTCC \", -1 /* CACHED */)), $setup.sortKey === 'btcc' ? (_openBlock(), _createElementBlock(\"span\", _hoisted_6, _toDisplayString($setup.sortDesc ? '↓' : '↑'), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true)]), _createElementVNode(\"th\", {\n    onClick: _cache[3] || (_cache[3] = $event => $setup.setSort('mexc')),\n    style: {\n      \"cursor\": \"pointer\"\n    }\n  }, [_cache[8] || (_cache[8] = _createTextVNode(\" MEXC \", -1 /* CACHED */)), $setup.sortKey === 'mexc' ? (_openBlock(), _createElementBlock(\"span\", _hoisted_7, _toDisplayString($setup.sortDesc ? '↓' : '↑'), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true)]), _createElementVNode(\"th\", {\n    onClick: _cache[4] || (_cache[4] = $event => $setup.setSort('bingx')),\n    style: {\n      \"cursor\": \"pointer\"\n    }\n  }, [_cache[9] || (_cache[9] = _createTextVNode(\" BINGX \", -1 /* CACHED */)), $setup.sortKey === 'bingx' ? (_openBlock(), _createElementBlock(\"span\", _hoisted_8, _toDisplayString($setup.sortDesc ? '↓' : '↑'), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true)])])]), _createElementVNode(\"tbody\", null, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.sortedRates, item => {\n    return _openBlock(), _createElementBlock(\"tr\", {\n      key: item.symbol\n    }, [_createElementVNode(\"td\", null, _toDisplayString($setup.formatSymbol(item.symbol)), 1 /* TEXT */), _createElementVNode(\"td\", {\n      class: _normalizeClass($setup.rateClass(item.btcc))\n    }, _toDisplayString($setup.formatRate(item.btcc)), 3 /* TEXT, CLASS */), _createElementVNode(\"td\", {\n      class: _normalizeClass($setup.rateClass(item.mexc))\n    }, _toDisplayString($setup.formatRate(item.mexc)), 3 /* TEXT, CLASS */), _createElementVNode(\"td\", {\n      class: _normalizeClass($setup.rateClass(item.bingx))\n    }, _toDisplayString($setup.formatRate(item.bingx)), 3 /* TEXT, CLASS */)]);\n  }), 128 /* KEYED_FRAGMENT */))])])]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createElementVNode","_createCommentVNode","_hoisted_2","_hoisted_3","for","type","id","$setup","tempThreshold","$event","step","min","max","onKeyup","_withKeys","confirmThreshold","onClick","refreshData","_hoisted_4","_toDisplayString","filterThreshold","_cache","setSort","style","sortKey","_hoisted_5","sortDesc","_hoisted_6","_hoisted_7","_hoisted_8","_Fragment","_renderList","sortedRates","item","key","symbol","formatSymbol","_normalizeClass","rateClass","btcc","formatRate","mexc","bingx"],"sources":["C:\\Users\\kuo\\Desktop\\btcc\\funding_rate_vue\\src\\App.vue"],"sourcesContent":["<template>\r\n  <div class=\"container\">\r\n    <h2>Funding Rate Board</h2>\r\n    \r\n    <!-- 設定區域 -->\r\n    <div class=\"settings-panel\">\r\n      <div class=\"setting-item\">\r\n        <label for=\"threshold\">過濾閾值 (%):</label>\r\n        <input \r\n          type=\"number\" \r\n          id=\"threshold\" \r\n          v-model=\"tempThreshold\" \r\n          step=\"0.001\" \r\n          min=\"0.001\" \r\n          max=\"10\"\r\n          class=\"threshold-input\"\r\n          @keyup.enter=\"confirmThreshold\"\r\n        />\r\n        <button @click=\"confirmThreshold\" class=\"confirm-btn\">確認</button>\r\n        <button @click=\"refreshData\" class=\"refresh-btn\">重新整理</button>\r\n        <span class=\"threshold-info\">目前顯示閾值: {{ filterThreshold }}%</span>\r\n      </div>\r\n    </div>\r\n    \r\n    <table>\r\n      <thead>\r\n        <tr>\r\n          <th @click=\"setSort('symbol')\" style=\"cursor:pointer\">\r\n            Symbol <span v-if=\"sortKey==='symbol'\">{{ sortDesc ? '↓' : '↑' }}</span>\r\n          </th>\r\n          <th @click=\"setSort('btcc')\" style=\"cursor:pointer\">\r\n            BTCC <span v-if=\"sortKey==='btcc'\">{{ sortDesc ? '↓' : '↑' }}</span>\r\n          </th>\r\n          <th @click=\"setSort('mexc')\" style=\"cursor:pointer\">\r\n            MEXC <span v-if=\"sortKey==='mexc'\">{{ sortDesc ? '↓' : '↑' }}</span>\r\n          </th>\r\n          <th @click=\"setSort('bingx')\" style=\"cursor:pointer\">\r\n            BINGX <span v-if=\"sortKey==='bingx'\">{{ sortDesc ? '↓' : '↑' }}</span>\r\n          </th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        <tr v-for=\"item in sortedRates\" :key=\"item.symbol\">\r\n          <td>{{ formatSymbol(item.symbol) }}</td>\r\n          <td :class=\"rateClass(item.btcc)\">{{ formatRate(item.btcc) }}</td>\r\n          <td :class=\"rateClass(item.mexc)\">{{ formatRate(item.mexc) }}</td>\r\n          <td :class=\"rateClass(item.bingx)\">{{ formatRate(item.bingx) }}</td>\r\n        </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed, onMounted, onUnmounted } from 'vue'\r\nimport { io } from 'socket.io-client'\r\n\r\nconst fundingRates = ref([])\r\nconst sortKey = ref('symbol')\r\nconst sortDesc = ref(false)\r\nconst filterThreshold = ref(0.02)\r\nconst tempThreshold = ref(0.02)\r\nlet socket = null\r\n\r\nfunction rateClass(rate) {\r\n  if (rate === null || rate === undefined) return ''\r\n  return Math.abs(rate) > 0.5 ? 'high' : Math.abs(rate) > 0.2 ? 'mid' : ''\r\n}\r\n\r\nfunction formatRate(rate) {\r\n  return rate !== null && rate !== undefined ? rate.toFixed(4) + '%' : ''\r\n}\r\n\r\nfunction formatSymbol(symbol) {\r\n  if (!symbol) return ''\r\n  // 後端已經統一處理了符號標準化，直接顯示即可\r\n  return symbol.toUpperCase()\r\n}\r\n\r\nasync function confirmThreshold() {\r\n  await updateThreshold()\r\n}\r\n\r\nasync function updateThreshold() {\r\n  try {\r\n    const response = await fetch('http://localhost:5000/api/filter_threshold', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({ threshold: tempThreshold.value })\r\n    })\r\n    \r\n    const result = await response.json()\r\n    if (result.success) {\r\n      filterThreshold.value = result.threshold\r\n      console.log(`閾值已更新為: ${result.threshold}%`)\r\n      // 重新獲取數據以應用新的過濾條件\r\n      await fetchInitialData()\r\n    } else {\r\n      console.error('更新閾值失敗:', result.error)\r\n      // 重置臨時閾值\r\n      tempThreshold.value = filterThreshold.value\r\n    }\r\n  } catch (error) {\r\n    console.error('更新閾值錯誤:', error)\r\n    tempThreshold.value = filterThreshold.value\r\n  }\r\n}\r\n\r\nasync function refreshData() {\r\n  try {\r\n    await fetchInitialData()\r\n    console.log('數據已重新整理')\r\n  } catch (error) {\r\n    console.error('重新整理數據失敗:', error)\r\n  }\r\n}\r\n\r\nasync function fetchCurrentThreshold() {\r\n  try {\r\n    const response = await fetch('http://localhost:5000/api/filter_threshold')\r\n    const result = await response.json()\r\n    filterThreshold.value = result.threshold\r\n    tempThreshold.value = result.threshold\r\n  } catch (error) {\r\n    console.error('獲取閾值錯誤:', error)\r\n  }\r\n}\r\n\r\nfunction setSort(key) {\r\n  if (sortKey.value === key) {\r\n    sortDesc.value = !sortDesc.value\r\n  } else {\r\n    sortKey.value = key\r\n    sortDesc.value = false\r\n  }\r\n}\r\n\r\nconst sortedRates = computed(() => {\r\n  const arr = [...fundingRates.value]\r\n  arr.sort((a, b) => {\r\n    let v1 = a[sortKey.value]\r\n    let v2 = b[sortKey.value]\r\n    if (sortKey.value === 'symbol') {\r\n      v1 = v1?.toUpperCase() || ''\r\n      v2 = v2?.toUpperCase() || ''\r\n      return sortDesc.value ? v2.localeCompare(v1) : v1.localeCompare(v2)\r\n    } else {\r\n      v1 = v1 ?? -Infinity\r\n      v2 = v2 ?? -Infinity\r\n      return sortDesc.value ? v2 - v1 : v1 - v2\r\n    }\r\n  })\r\n  return arr\r\n})\r\n\r\nasync function fetchInitialData() {\r\n  const res = await fetch('http://localhost:5000/api/funding_rates')\r\n  const data = await res.json()\r\n  fundingRates.value = data\r\n}\r\n\r\nonMounted(() => {\r\n  fetchInitialData()\r\n  fetchCurrentThreshold()\r\n  \r\n  socket = io('http://localhost:5000')\r\n  \r\n  // 處理資金費率更新\r\n  socket.on('funding_rate_update', (update) => {\r\n    const idx = fundingRates.value.findIndex(i => i.symbol === update.symbol)\r\n    if (idx >= 0) {\r\n      // 更新現有項目\r\n      fundingRates.value[idx][update.exchange.toLowerCase()] = update.rate\r\n    } else {\r\n      // 創建新項目\r\n      const newItem = {\r\n        symbol: update.symbol,\r\n        btcc: null,\r\n        mexc: null,\r\n        bingx: null\r\n      }\r\n      newItem[update.exchange.toLowerCase()] = update.rate\r\n      fundingRates.value.push(newItem)\r\n    }\r\n  })\r\n  \r\n  // 處理資金費率刪除\r\n  socket.on('funding_rate_delete', (deleteInfo) => {\r\n    const idx = fundingRates.value.findIndex(i => i.symbol === deleteInfo.symbol)\r\n    if (idx >= 0) {\r\n      // 將對應交易所的費率設為 null\r\n      fundingRates.value[idx][deleteInfo.exchange.toLowerCase()] = null\r\n      \r\n      // 如果所有交易所的費率都為 null，則刪除整個項目\r\n      const item = fundingRates.value[idx]\r\n      if (item.btcc === null && item.mexc === null && item.bingx === null) {\r\n        fundingRates.value.splice(idx, 1)\r\n      }\r\n    }\r\n  })\r\n  \r\n  // 處理閾值更新通知\r\n  socket.on('threshold_updated', (data) => {\r\n    filterThreshold.value = data.threshold\r\n    tempThreshold.value = data.threshold\r\n    console.log(`閾值已更新為: ${data.threshold}%`)\r\n    // 重新獲取數據以應用新的過濾條件\r\n    fetchInitialData()\r\n  })\r\n})\r\n\r\nonUnmounted(() => {\r\n  if (socket) socket.disconnect()\r\n})\r\n</script>\r\n\r\n<style>\r\nbody { background: #181818; color: #eee; font-family: 'Segoe UI', Arial, sans-serif; }\r\n.container { max-width: 900px; margin: 40px auto; background: #222; padding: 24px; border-radius: 12px; box-shadow: 0 2px 16px #0008; }\r\nh2 { text-align: center; margin-bottom: 24px; color: #00bfff; }\r\n\r\n.settings-panel { \r\n  background: #333; \r\n  padding: 16px; \r\n  border-radius: 8px; \r\n  margin-bottom: 24px; \r\n  border: 1px solid #444;\r\n}\r\n\r\n.setting-item { \r\n  display: flex; \r\n  align-items: center; \r\n  gap: 12px; \r\n  flex-wrap: wrap;\r\n}\r\n\r\n.setting-item label { \r\n  color: #00bfff; \r\n  font-weight: bold; \r\n  min-width: 120px;\r\n}\r\n\r\n.threshold-input { \r\n  background: #444; \r\n  border: 1px solid #555; \r\n  color: #eee; \r\n  padding: 8px 12px; \r\n  border-radius: 4px; \r\n  width: 120px;\r\n  font-size: 14px;\r\n}\r\n\r\n.threshold-input:focus { \r\n  outline: none; \r\n  border-color: #00bfff; \r\n  box-shadow: 0 0 0 2px rgba(0, 191, 255, 0.2);\r\n}\r\n\r\n.threshold-info { \r\n  color: #999; \r\n  font-size: 12px; \r\n  font-style: italic;\r\n}\r\n\r\ntable { border-collapse: collapse; width: 100%; background: #222; }\r\nth, td { border: 1px solid #333; padding: 12px 8px; text-align: center; }\r\nth { background: #333; color: #fff; font-size: 1.1em; }\r\ntr:nth-child(even) { background: #282828; }\r\n.high { color: #e74c3c; font-weight: bold; background: #2c0a0a; }\r\n.mid { color: #f39c12; font-weight: bold; background: #2c1a0a; }\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}